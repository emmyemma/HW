<html>
  <script src="https://cunning-wolf-50qhhu-dev-ed.trailblaze.my.site.com/lightning/lightning.out.js"></script>
  <div data-lightning-out="true"></div>
  <script>
    
    // only run OAuth if there is no code, otherwise infinite loop
    const thisurl = window.location.href;
    
    if(!thisurl.includes('code')) {
    // Set up OAuth
      const domainName = 'cunning-wolf-50qhhu-dev-ed.trailblaze.lightning.force.com';
      const client_id = '3MVG9ux34Ig8G5eoAUalnJI3xuV1f6AdldGsAIBW54QigSpW1W0B9rCawuuRFZ.ls.btbUdurx3x3B2vA_wG0';
      const redirect_uri = 'https://emmyemma.github.io/HW/';
      const response_type = 'code';
      const url = 'https://' + domainName + '/services/oauth2/authorize?client_id=' + client_id + '&redirect_uri=' + redirect_uri + '&response_type=' + response_type; 
      window.location.replace(url);
    } else {
      const urlParams = new URLSearchParams(queryString);
      const oauthtoken = urlParams.search('code');
      const appName = 'c:helloWorldDependency';
      const componentName = 'c:helloWorld';
      const lightningEndpoint = 'https://cunning-wolf-50qhhu-dev-ed.trailblaze.my.site.com';
      const targetElement = document.querySelector("[data-lightning-out]");
      const componentAttributes = {};

      $Lightning.use(appName,
                     function() {
                      $Lightning.createComponent(
                        componentName,
                        componentAttributes,
                        targetElement,
                        function(cmp) {
                          console.log('lightning component created');
      });}, lightningEndpoint, oauthtoken);
    }
  </script>
</html>
